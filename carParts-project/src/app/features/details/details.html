<div class="breadcrumb-area">
  <div class="container">
    <div class="breadcrumb-content">
      <h2>Product Details</h2>
      <ul>
        <li><a routerLink="/">Home</a></li>
        <li class="active">Single Product</li>
      </ul>
    </div>
  </div>
</div>

@if (isLoadingPart) {
  <div class="container">
    <app-ring-spinner 
      message="Loading product details..." 
      size="large"
      color="#c0c0c0">
    </app-ring-spinner>
  </div>
} @else if (part) {
<div class="sp-area">
  <div class="container-fluid">
    <div class="sp-nav">
      <div class="row">
        <div class="col-lg-4">
          <div class="sp-img_area">
            <div class="sp-img_slider slick-img-slider uren-slick-slider">
              <div class="single-slide red zoom">
                <img [src]="part.imageUrl" alt="Product Image" />
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-8">
          <div class="sp-content">
            <div class="sp-heading">
              <h5><a href="#">{{ part.title }}</a></h5>
            </div>
            <div class="rating-box">
              <ul>
                <li *ngFor="let i of stars; let idx = index" [class.silver-color]="isSilver(idx, part.rating)">
                  <i aria-hidden="true">★</i>
                </li>
              </ul>
            </div>
            <div class="sp-essential_stuff">
              <ul>
                <li>Brands <button class="btn-link">{{ part.brand }}</button></li>
                <li>Stock: <button class="btn-link">{{ part.quantity }} pieces</button></li>
                <li>Price: <button class="btn-link">${{ part.price }}</button></li>
                <li>Year: <button class="btn-link">{{ part.year }}</button></li>
              </ul>
            </div>
            <div class="qty-btn_area">
              <ul>
                <li *ngIf="isOwner && isAuthenticated"><a class="qty-edit_btn uren-btn_dark d-flex align-items-center" [routerLink]="['/catalog', part._id, 'edit']">
                  <i class="fa fa-edit" style="margin-right: 5px"></i> <span>Edit Part</span>
                </a></li>
                <li *ngIf="isOwner && isAuthenticated"><a href="#" class="qty-edit_btn uren-btn_dark d-flex align-items-center" (click)="$event.preventDefault(); deletePart();">
                  <i class="fa fa-trash" style="margin-right: 5px"></i> <span>Delete</span>
                </a></li>
              </ul>
            </div>
            <div class="uren-tag-line">
              <h6>Category:</h6>
              <a href="#" (click)="$event.preventDefault()">{{ part.category }}</a>
            </div>
            <div class="uren-social_link">
                <ul>
                    <li class="facebook">
                        <a href="https://www.facebook.com/" data-toggle="tooltip" target="_blank" title="Facebook">
                            <i class="fab fa-facebook"></i>
                        </a>
                    </li>
                    <li class="twitter">
                        <a href="https://twitter.com/" data-toggle="tooltip" target="_blank" title="Twitter">
                            <i class="fab fa-twitter-square"></i>
                        </a>
                    </li>
                    <li class="youtube">
                        <a href="https://www.youtube.com/" data-toggle="tooltip" target="_blank" title="Youtube">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </li>
                    <li class="google-plus">
                        <a href="https://www.plus.google.com/discover" data-toggle="tooltip" target="_blank" title="Google Plus">
                            <i class="fab fa-google-plus"></i>
                        </a>
                    </li>
                    <li class="instagram">
                        <a href="https://rss.com/" data-toggle="tooltip" target="_blank" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </li>
                </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="sp-product-tab_area">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-12">
        <div class="sp-product-tab_nav">
          <div class="product-tab">
            <ul class="nav product-menu">
              <li>
                <a href="#" [class.active]="activeTab === 'description'" (click)="$event.preventDefault(); selectTab('description')">
                  <span>Description</span>
                </a>
              </li>
              <li>
                <a href="#" [class.active]="activeTab === 'reviews'" (click)="$event.preventDefault(); selectTab('reviews')">
                  <span>Reviews ({{ comments.length }})</span>
                </a>
              </li>
            </ul>
          </div>
          <div class="tab-content uren-tab_content">
            <div id="description" class="tab-pane" [class.active]="activeTab === 'description'" [class.show]="activeTab === 'description'" role="tabpanel">
              <div class="product-description">
                <span>{{ part.description }}</span>
              </div>
            </div>
            <div id="reviews" class="tab-pane" [class.active]="activeTab === 'reviews'" [class.show]="activeTab === 'reviews'" role="tabpanel">
              <div class="tab-pane active" id="tab-review">
                <form class="form-horizontal" (ngSubmit)="submitComment()" #reviewForm="ngForm" novalidate>
                  <div id="review">
                    @if (isLoadingComments) {
                      <div class="text-center p-4">
                        <app-ring-spinner 
                          message="Loading reviews..." 
                          size="medium"
                          color="#c0c0c0">
                        </app-ring-spinner>
                      </div>
                    } @else {
                      <table class="table table-striped table-bordered" *ngIf="comments.length; else noComments">
                        <tbody *ngFor="let comment of comments">
                          <tr>
                            <td style="width:50%"><strong>{{ comment.author?.email || 'Anonymous' }}</strong></td>
                            <td class="text-right">{{ comment.currentDate }}</td>
                          </tr>
                          <tr>
                            <td colspan="2">
                              <p>{{ comment.text }}</p>
                              <div class="rating-box d-flex justify-content-between align-items-center">
                                <ul class="d-flex">
                                  <li *ngFor="let i of stars; let idx = index" [class.silver-color]="isSilver(idx, comment.rating)">
                                    <i aria-hidden="true">★</i>
                                  </li>
                                </ul>
                                <div class="comment-actions d-flex" *ngIf="canDeleteComment(comment)">
                                  <button type="button" class="uren-btn uren-btn_sm uren-btn_dark delete-btn-wide" (click)="deleteComment(comment._id)"><span class="btn-label">Delete</span></button>
                                </div>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                      <ng-template #noComments>
                        <table class="table table-striped table-bordered">
                          <tbody>
                            <tr><td colspan="2">There are no reviews for this product.</td></tr>
                          </tbody>
                        </table>
                      </ng-template>
                    }
                  </div>
                  <div class="review-box" *ngIf="isAuthenticated; else pleaseLogin">
                    <h2>Write a review</h2>
                    <div class="form-group required second-child">
                      <div class="col-sm-12 p-0">
                        <label class="control-label">Share your opinion *</label>
                        <textarea 
                          class="review-textarea form-control" 
                          name="text" 
                          id="text" 
                          [(ngModel)]="text"
                          placeholder="Write your review here..."
                          rows="4">
                        </textarea>
                      </div>
                    </div>
                    <div class="form-group last-child required">
                      <div class="col-sm-12 p-0">
                        <div class="your-opinion">
                          <label>Your Rating *</label>
                          <span>
                            <select class="star-rating form-control" name="rating" id="rating" [(ngModel)]="rating">
                              <option [ngValue]="1">⭐ 1 - Poor</option>
                              <option [ngValue]="2">⭐⭐ 2 - Fair</option>
                              <option [ngValue]="3">⭐⭐⭐ 3 - Good</option>
                              <option [ngValue]="4">⭐⭐⭐⭐ 4 - Very Good</option>
                              <option [ngValue]="5">⭐⭐⭐⭐⭐ 5 - Excellent</option>
                            </select>
                          </span>
                          
                        </div>
                      </div>
                      <div class="uren-btn-ps_right">
                        <button 
                          type="submit" 
                          class="uren-btn-2"
                          [disabled]="isSubmitting">
                          Submit Review
                        </button>
                      </div>
                    </div>
                  </div>
                  <ng-template #pleaseLogin>
                    <div class="review-box">
                      <h6>To leave a review, please <a routerLink="/login">log in</a></h6>
                    </div>
                  </ng-template>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
}

